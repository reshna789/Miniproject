
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Notifications - ArtoMart</title>
  {% load static %}
  <link rel="stylesheet" href="{% static 'artworks/css/notification.css' %}?v=128">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
</head>
<body>

<!-- Navbar -->
<nav class="navbar">
  <div class="logo">
    <img src="{% static 'artworks/images/logo.png' %}" alt="Logo">
    <span class="brand">ARTOMART</span>
  </div>
  <div class="nav-icons">

    <ul>
     <li><a href="{% url 'userdashboard' %}">Home</a></li>
    
    <li><a href="{% url 'cart' %}"  class="cart-link">Cart<span id="cartCount" class="cart-count">0</span></a></li>
    <li><a href="{% url 'logout_page' %}" >Logout</a></li>
    <li><a href="{% url 'profile_redirect' %}" >Profile</a></li>
    </ul>
  </div>
</nav>



<br><br><br><br><br><br>
<header>
  <h1>Notifications</h1>
</header>

<main class="notifications-grid" id="notificationsGrid">
  {% if notifications %}
    {% for notif in notifications %}
      <div class="notif-card {% if not notif.is_read %}unread{% endif %}">
        <p class="notif-message">{{ notif.message|safe }}</p>
        <div class="notif-meta">
          <small class="notif-time">Received: {{ notif.created_at|date:"Y-m-d H:i:s" }}</small>
          {% if not notif.is_read %}
            <a href="{% url 'mark_notification_read' notif.id %}" class="mark-read-btn">Mark as read</a>
          {% endif %}
        </div>
      </div>
    {% empty %}
      <p class="no-notifs">No notifications.</p>
    {% endfor %}
  {% else %}
    <p class="no-notifs">No notifications yet.</p>
  {% endif %}
</main>


<script>
  async function updateCartCount() {
  try {
    const response = await fetch("/cart/get/");
    const data = await response.json();
    const cartCount = document.getElementById("cartCount");
    if(cartCount){
      cartCount.textContent = data.cart.length || 0;
    }
  } catch(err){
    console.error("Failed to fetch cart count:", err);
    const cartCount = document.getElementById("cartCount");
    if(cartCount) cartCount.textContent = 0;
  }
}

// Call it on page load
document.addEventListener("DOMContentLoaded", () => {
  updateCartCount();
});

  // ===== Optional: Search Notifications =====
  const searchBar = document.getElementById("searchBar");
  searchBar.addEventListener("input", () => {
    const query = searchBar.value.toLowerCase();
    const cards = document.querySelectorAll("#notificationsGrid .notif-card");
    cards.forEach(card => {
      const text = card.querySelector("h3").textContent.toLowerCase();
      card.style.display = text.includes(query) ? "block" : "none";
    });
  });
</script>

</body>
</html>
