
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Sign Up | ArtoMart</title>
  {% load static %}
  <link rel="stylesheet" href="{% static 'artworks/css/login.css' %}?v=124" />
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;700;900&display=swap" rel="stylesheet">
</head>
<body>
  <div class="login-container">
    <div class="login-box">
      <h1>Create Account ✨</h1>
      <p>Join ArtoMart and start your journey</p>

        <form method="POST" action="{% url 'register' %}" id="signupForm">
        {% csrf_token %}
        <input type="text" name="username" placeholder="Full Name" required />

        <input type="email" name="email" id="email" placeholder="Email" required />
        <div id="emailError" class="error-message"></div>

        <div class="password-field">
          <input type="password" name="password1" id="password" placeholder="Password" required />
          <button type="button" class="show-pass" onclick="togglePassword('password')"></button>
        </div>
        <div id="passwordError" class="error-message"></div>

        <div class="password-field">
          <input type="password" name="password2" id="confirmPassword" placeholder="Confirm Password" required />
          <button type="button" class="show-pass" onclick="togglePassword('confirmPassword')"></button>
        </div>
        <div id="confirmError" class="error-message"></div>

        <button type="submit" class="btn">Sign Up</button>
      </form>

      <p class="signup-text">
        Already have an account? <a href="{% url 'login' %}">Login</a>
      </p>
    </div>
  </div>

  <div class="success-popup" id="successPopup">✅ Registration Successful! Redirecting...</div>

  <script>
    // ✅ Toggle password visibility
    function togglePassword(id) {
      const field = document.getElementById(id);
      field.type = field.type === "password" ? "text" : "password";
    }

    // ✅ Form Validation
    document.getElementById("signupForm").addEventListener("submit", function(event) {
      const email = document.getElementById("email").value.trim();
      const password = document.getElementById("password").value.trim();
      const confirmPassword = document.getElementById("confirmPassword").value.trim();

      const emailError = document.getElementById("emailError");
      const passwordError = document.getElementById("passwordError");
      const confirmError = document.getElementById("confirmError");

      let valid = true;

      // ✅ Correct email regex (no double slashes)
      const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      if (!emailPattern.test(email)) {
        emailError.style.display = "block";
        emailError.innerText = "Please enter a valid email (e.g., name@example.com)";
        valid = false;
      } else {
        emailError.style.display = "none";
      }

      // ✅ Correct password regex (no double slashes)
      const passwordPattern = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d).{8,}$/;
      if (!passwordPattern.test(password)) {
        passwordError.style.display = "block";
        passwordError.innerText = "Password must be 8+ chars with upper, lower & number.";
        valid = false;
      } else {
        passwordError.style.display = "none";
      }

      // ✅ Confirm password
      if (password !== confirmPassword) {
        confirmError.style.display = "block";
        confirmError.innerText = "Passwords do not match.";
        valid = false;
      } else {
        confirmError.style.display = "none";
      }

      // ❌ Stop form only if invalid
      if (!valid) {
        event.preventDefault();
        return false;
      }

      // ✅ Show success popup & allow submission to backend
      const popup = document.getElementById("successPopup");
      popup.style.display = "block";

      // Optional: redirect manually after short delay
      setTimeout(() => {
        window.location.href = "{% url 'login' %}";
      }, 2000);
    });
  </script>
</body>
</html>